<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <title>Detalles de Receta - Gumia</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/styles.css">

    <style>
        .recipe-header-img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            border-radius: 15px 15px 0 0;
        }

        .recipe-steps {
            white-space: pre-wrap;
            font-size: 1.1rem;
            color: var(--gumia-body-text);
            line-height: 1.6;
        }

        .ingredient-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
    </style>
</head>
<body class="bg-light py-5">

<div class="container">

    <div class="mb-4">
        <a href="/" class="btn btn-outline-primary fw-bold">
            ‚Üê Volver a Inicio
        </a>
    </div>

    <div class="card shadow-sm border-0 rounded-4">

        <img th:src="${receta.url_imagen != null and !receta.url_imagen.isEmpty() ? receta.url_imagen : 'https://images.unsplash.com/photo-1495521821757-a1efb6729352?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80'}"
             class="recipe-header-img img-error-handler"
             alt="Foto de la receta">

        <div class="card-body p-4 p-md-5">

            <h1 class="display-4 fw-bold mb-2" style="color: var(--gumia-text);" th:text="${receta.titulo}">T√≠tulo</h1>

            <p class="lead text-muted mb-4" th:text="${receta.descripcion}">Descripci√≥n corta...</p>

            <div class="mb-4 d-flex flex-wrap gap-2">
                <span class="badge bg-info rounded-pill px-4 py-2 fs-5 text-dark" th:text="${receta.categoria}">Categor√≠a</span>

                <span class="badge bg-light text-dark border px-4 py-2 fs-5">
                    üë®‚Äçüç≥ Dificultad: <span th:text="${receta.dificultad}">1</span>/5
                </span>

                <span class="badge bg-dark px-4 py-2 fs-5">
                    ‚è± <span th:text="${receta.tiempo}">30</span> min
                </span>
            </div>

            <hr class="my-4 text-muted">

            <div class="row">
                <div class="col-md-5 mb-4">
                    <div class="p-4 rounded-3" style="background-color: var(--gumia-bg);">
                        <h2 class="fw-bold mb-4" style="color: var(--gumia-primary);">Ingredientes</h2>

                        <ul class="list-unstyled">
                            <li class="ingredient-item d-flex justify-content-between align-items-center" th:each="ing : ${receta.ingredientes}">
                                <span th:text="${ing.nombre}" class="fw-bold fs-5">Ingrediente</span>
                                <span class="badge bg-white text-dark shadow-sm fs-6" th:text="${ing.cantidad}">Cant</span>
                            </li>

                            <li class="text-muted fst-italic mt-2" th:if="${#lists.isEmpty(receta.ingredientes)}">
                                <small>No se han especificado ingredientes detallados.</small>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-7 ps-md-5">
                    <h2 class="fw-bold mb-3" style="color: var(--gumia-primary);">Preparaci√≥n</h2>

                    <div class="recipe-steps" th:text="${receta.preparacion}">
                        Aqu√≠ ir√°n los pasos...
                    </div>
                </div>
            </div>

            <div class="mt-5 pt-3 border-top d-flex justify-content-between align-items-center">
                <span class="text-muted fs-5">
                    Publicado por: <strong th:text="${receta.autor != null ? receta.autor.nombre : 'Gumia Chef'}">Autor</strong>
                </span>

                <div th:if="${session.usuarioLogueado != null}">
                    <a th:href="@{/favoritos/add/{id}(id=${receta.id})}"
                       class="btn btn-outline-primary btn-lg fw-bold px-4 shadow-sm">
                        ‚ù§Ô∏è A√±adir a Favoritos
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const images = document.querySelectorAll('.img-error-handler');
        images.forEach(img => {
            img.addEventListener('error', function() {
                this.src = 'https://images.unsplash.com/photo-1495521821757-a1efb6729352?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80';
            }, { once: true });
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>